(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["gang-diplomacy"],{af50:function(n,t,e){"use strict";e.r(t);var a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",[e("GangsTabs"),e("div",{staticClass:"anim-fade-in"},[n.embassy.lvl>0?e("div",[e("div",{staticClass:"p-4 text-center"},[n.isInit?e("Loading"):e("div",[e("h1",{staticClass:"mb-4"},[n.mygang&&n.mygang.image?e("GangImage",{staticClass:"mr-3",attrs:{size:"120",image:n.mygang.image}}):n._e(),n.mygang?e("div",[n._v(n._s(n.mygang.name||n.mygang.gang))]):n._e(),n.mygang.ticker?e("span",[n._v("["+n._s(n.mygang.ticker)+"]")]):n._e()],1),e("div",[e("h3",[n._v("Choose Action")]),n._l(n.gangs,(function(t){return t.gang!==n.mygang.gang?e("div",{key:t.gang,staticClass:"py-3 px-0 m-1 columns text-left border-bottom"},[e("h2",{staticClass:"mt-0 column col-6"},[t.image?e("GangImage",{staticClass:"mr-2",attrs:{size:"40",image:t.image}}):n._e(),t&&t.ticker?e("router-link",{attrs:{to:"/gangs/gang/"+t.gang}},[n._v(n._s(t.name||t.gang)+" ["+n._s(t.ticker)+"]\n                                    "),"alliance"===n.otherEvents(t.gang).event_type&&"alliance"===n.myEvents(t.gang).event_type?e("UiButton",{staticClass:"button ml-2 allies button-green "},[n.isLoading?e("SmallLoading"):e("span",[n._v("ALLIES")])],1):n._e()],1):n._e()],1),e("div",{staticClass:"column col-6 text-right"},["war"===n.otherEvents(t.gang).event_type||"war"===n.myEvents(t.gang).event_type?e("UiButton",{staticClass:"button button-blue mb-2",attrs:{disabled:n.isLoading||"war"===n.otherEvents(t.gang).event_type||n.lastUpdate(n.myEvents(t.gang))&&"war"===n.myEvents(t.gang).event_type||"war"!==n.myEvents(t.gang).event_type},on:{click:function(e){n.handleStop("war",t.gang)}}},[n.isLoading?e("SmallLoading"):e("span",[n._v("stop war")])],1):e("div",[e("UiButton",{staticClass:"button button-red mb-2 mr-2",attrs:{disabled:n.isLoading||"war"===n.otherEvents(t.gang).event_type||"war"===n.myEvents(t.gang).event_type||"alliance"===n.myEvents(t.gang).event_type},on:{click:function(e){n.handleSubmit("war",t.gang)}}},[n.isLoading?e("SmallLoading"):e("span",[n._v("declare war")])],1),e("UiButton",{staticClass:"button button-green ",attrs:{disabled:n.isLoading||"alliance"===n.myEvents(t.gang).event_type||"war"===n.myEvents(t.gang).event_type},on:{click:function(e){n.handleSubmit("alliance",t.gang)}}},[n.isLoading?e("SmallLoading"):e("span",[n._v("offer alliance")])],1)],1),"alliance"===n.otherEvents(t.gang).event_type||"alliance"===n.myEvents(t.gang).event_type?e("UiButton",{staticClass:"button button-blue mb-2 ",attrs:{disabled:n.isLoading||"alliance"!==n.myEvents(t.gang).event_type},on:{click:function(e){n.handleStop("alliance",t.gang)}}},[n.isLoading?e("SmallLoading"):e("span",[n._v("stop alliance")])],1):n._e(),"alliance"===n.otherEvents(t.gang).event_type&&"alliance"!==n.myEvents(t.gang).event_type?e("UiButton",{staticClass:"button button-blue mb-2 ml-2",attrs:{disabled:n.isLoading||"alliance"!==n.otherEvents(t.gang).event_type},on:{click:function(e){n.handleSubmit("alliance",t.gang)}}},[n.isLoading?e("SmallLoading"):e("span",[n._v("accept alliance")])],1):n._e(),"alliance"===n.otherEvents(t.gang).event_type&&"alliance"!==n.myEvents(t.gang).event_type?e("UiButton",{staticClass:"button button-blue mb-2 ml-2",attrs:{disabled:n.isLoading||"alliance"!==n.otherEvents(t.gang).event_type},on:{click:function(e){n.handleStop("alliance",t.gang)}}},[n.isLoading?e("SmallLoading"):e("span",[n._v("refuse alliance")])],1):n._e()],1)]):n._e()}))],2)])],1)]):e("div",{staticClass:"p-2 text-center"},[e("h2",[n._v("You must build an embassy first.")])])])],1)},s=[],i=e("cebc"),g=(e("7514"),e("768b")),o=(e("ac6a"),e("5df3"),e("2f62")),l=e("f684"),r=e.n(l),c=e("451e"),d={data:function(){return{id:this.$route.params.id,isInit:!1,isLoading:!1,mygang:null,gangs:null,members:null,message:null,user:this.$store.state.game.user.user,events:null}},created:function(){var n=this;this.isLoading=!0,this.load_buildings();var t=[c["a"].requestAsync("get_gangs",null),c["a"].requestAsync("get_gang",this.id),c["a"].requestAsync("get_gang_members",this.id),c["a"].requestAsync("get_gang_events",this.id)];r.a.all(t).then((function(t){var e=Object(g["a"])(t,4);n.gangs=e[0];var a=Object(g["a"])(e[1],1);n.mygang=a[0],n.members=e[2],n.events=e[3],n.isInit=!1,n.isLoading=!1}))},computed:{embassy:function(){return this.$store.state.game.gang_buildings.find((function(n){return"embassy"===n.building}))||{lvl:0}},isBoss:function(){return"boss"===this.user.role&&this.user.gang===this.id}},methods:Object(i["a"])({},Object(o["b"])(["init","send","notify","refresh_gang_buildings"]),{handleSubmit:function(n,t){var e=this;this.isLoading=!0;var a={event:n,gang:t,type:"dw-gang-event"};this.send(a).then((function(n){console.log(n),e.load_events(),e.isLoading=!1})).catch((function(n){e.notify({type:"error",message:"Failed to create event"}),console.error("Failed to create gang",n),e.isLoading=!1}))},handleStop:function(n,t){var e=this;this.isLoading=!0;var a={event:n,gang:t,type:"dw-gang-stop-event"};this.send(a).then((function(){e.load_events(),e.isLoading=!1})).catch((function(n){e.notify({type:"error",message:"Failed to create event"}),console.error("Failed to create gang",n),e.isLoading=!1}))},load_buildings:function(){var n=this;this.isLoading=!0,this.refresh_gang_buildings().then((function(){n.isLoading=!1})).catch((function(t){console.error("Failed",t),n.isLoading=!1}))},load_events:function(){var n=this;this.isLoading=!0;var t=[c["a"].requestAsync("get_gangs",null),c["a"].requestAsync("get_gang",this.id),c["a"].requestAsync("get_gang_members",this.id),c["a"].requestAsync("get_gang_events",this.id)];r.a.all(t).then((function(t){var e=Object(g["a"])(t,4);n.gangs=e[0];var a=Object(g["a"])(e[1],1);n.mygang=a[0],n.members=e[2],n.events=e[3],n.isInit=!1,n.isLoading=!1}))},otherEvents:function(n){var t=this.events.filter((function(t){return t.gang===n}));return t[0]?t[0]:t},myEvents:function(n){var t=this.events.filter((function(t){return t.others===n}));return t[0]?t[0]:t},lastUpdate:function(n){var t=new Date;return t<new Date(Date.parse(n.next_update))}})},u=d,v=(e("f706"),e("2877")),m=Object(v["a"])(u,a,s,!1,null,"320a5712",null);t["default"]=m.exports},d187:function(n,t,e){},f706:function(n,t,e){"use strict";var a=e("d187"),s=e.n(a);s.a}}]);
//# sourceMappingURL=gang-diplomacy.41ea2437.js.map