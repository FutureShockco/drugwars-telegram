(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["unitsbunker"],{"09ee":function(t,e,n){},"110b":function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.ownBase?n("div",[n("BootcampTabs"),t.ownBase&&!t.bunker||!t.bunker.lvl?n("div",{staticClass:"p-4 container-lg clearfix anim-fade-in text-center"},[n("h2",[t._v(" You must build a bunker first.")])]):n("div",{staticClass:"p-4 container-lg clearfix anim-fade-in text-center"},[t.ownUnits.length>0&&!t.defenders||t.defenders.length<1?n("div",{staticClass:"p-2 text-center"},[t._v("Your bunker is\n        empty.\n      ")]):n("div",{staticClass:"mt-4 mb-2"},[n("h3",[t._v("Units in the bunker")]),n("ArmyToSend",{attrs:{units:t.defenders,disableicon:!0}}),n("h5",{staticClass:"mt-0"},[t._v("Army Value")]),n("h5",{staticClass:"mt-0"},[t._v("Drugs: "+t._s(t._f("amount")(t.defendercost.drugs))+" - Weapons: "+t._s(t._f("amount")(t.defendercost.weapons))+" -\n          Alcohol:\n          "+t._s(t._f("amount")(t.defendercost.alcohol)))]),n("h5",{staticClass:"mt-0"},[t._v("Power: "+t._s(t.defenderOffensivePower)+"%")]),n("h5",{staticClass:"mt-0"},[t._v("Supply: "+t._s(t._f("amount")(t.defendersupply))+" / "+t._s(t._f("amount")(t.maxSupply)))]),n("UiButton",{staticClass:"button button-large button-red mb-5 ",attrs:{disabled:!t.defenders||t.isLoading},on:{click:function(e){t.handleRelease()}}},[t.isLoading?n("SmallLoading"):n("span",[t._v("Release units")])],1)],1),t.ownUnits.length>0?n("div",{staticClass:"column col-12 flex-md-items-start mt-0"},[n("h3",{staticClass:"mb-0 mt-0"},[t._v("Select units to hide")]),t.showUnits&&t.ownUnits&&t.ownUnits.length>0?n("div",t._l(t.ownUnits,(function(e){return n("div",{key:e.key+t.ownBase.territory+t.ownBase.base},[e.amount>0?n("UnitSelect",{attrs:{item:e},on:{click:t.addUnit}}):t._e()],1)}))):n("div",[t._v("You must buy troops")])]):t._e(),t.ownUnits.length>0?n("UiButton",{staticClass:"button button-green mt-2 mb-2",attrs:{disabled:0===t.ownUnits.length},on:{click:function(e){t.autoFill()}}},[t._v("AutoFill")]):t._e(),t.ownUnits.length>0?n("div",{staticClass:"column col-12"},[n("div",{staticClass:"mb-2"},[n("h3",{staticClass:"mb-2"},[t._v("Your selected army")]),n("ArmyToSend",{attrs:{units:t.selectedUnits}})],1),n("div",{staticClass:"mb-0 form width-full"},[0===t.selectedUnits.length?n("div",[n("p",[t._v("You need to select at least 1 unit to defend this base.")])]):n("div",[n("h5",{staticClass:"mt-0"},[t._v("Defenders Value")]),n("h5",{staticClass:"mt-0"},[t._v("Drugs: "+t._s(t._f("amount")(t.cost.drugs))+" - Weapons: "+t._s(t._f("amount")(t.cost.weapons))+" - Alcohol:\n              "+t._s(t._f("amount")(t.cost.alcohol)))]),n("h5",{staticClass:"mt-0"},[t._v("Power: "+t._s(t.offensivePower)+"%")]),n("h5",{staticClass:"mt-0"},[t._v("Supply: "+t._s(t._f("amount")(t.supply))+" / "+t._s(t._f("amount")(t.maxSupply)))]),n("UiButton",{staticClass:"button button-blue mb-2",on:{click:function(e){t.removeUnits()}}},[t._v("Remove all")])],1)]),t.defenders&&t.defenders.length>0?n("div",{staticClass:"mb-3"},[t._v("Please release your units before adding new units.\n        ")]):t._e(),n("UiButton",{staticClass:"button button-large button-red mb-5 ",attrs:{disabled:t.defenders.length>0||t.tooMuchSupply||0===t.selectedUnits.length||t.isLoading},on:{click:function(e){t.handleSave()}}},[t.isLoading?n("SmallLoading"):n("span",[t._v("Save")])],1),t.errorMessage?n("p",{staticClass:"text-red text-left"},[t._v(t._s(t.errorMessage))]):t._e()],1):n("h2",{staticClass:"text-center"},[t._v("\n        You don't have any unit.\n        "),n("div",[n("router-link",{staticClass:"text-yellow",attrs:{to:"/units"}},[t._v("Click here to start to recruit")])],1)])],1)],1):n("div",{staticClass:"card card-style anim-fade-in"},[n("div",{staticClass:"content"},[n("h4",{staticClass:"text-center"},[t._v("\n        You must choose a location on the map first.\n        "),n("h2",[n("router-link",{staticClass:"text-yellow",attrs:{to:"/map/territory?location="+t.rnd}},[t._v("Click here to choose a\n            location.")])],1)])])])])},i=[],o=(n("7f7f"),n("f499")),a=n.n(o),r=n("a4bb"),u=n.n(r),c=(n("96cf"),n("3b8d")),l=(n("c5f6"),n("cebc")),d=n("e814"),f=n.n(d),h=(n("7514"),n("59ad")),m=n.n(h),v=(n("ac6a"),n("2f62")),b=n("451e"),p=n("7edb"),y=n("f684"),g=n.n(y),_=n("310e"),k=n.n(_),w={data:function(){return{isLoading:!1,base:this.$route.query.base||null,selectedUnits:[],message:null,username:this.$store.state.auth.username,errorMessage:null,baseName:null,favoriteCombinations:JSON.parse(localStorage.getItem("fav_combi_def"))||null,combination_name:null,units:[],bases:[],defenders:[],active:!1,showUnits:!0}},components:{draggable:k.a},created:function(){this.isLoading=!0,this.loadDefenders()},watch:{ownBase:function(){this.loadDefenders()},ownUnits:function(){var t=this,e=[];return this.storeUnits.forEach((function(n){n.territory===t.ownBase.territory&&n.base===t.ownBase.base&&n.amount>0&&e.push({key:n.unit,amount:n.amount})})),e}},computed:{ownBase:function(){return this.$store.state.game.mainbase},allbase:function(){return this.$store.state.game.user.buildings||null},nickname:function(){return this.$store.state.game.user.user.nickname},user:function(){return this.$store.state.game.user.user},ownUnits:function(){var t=this,e=[],n=this;return this.showUnits=!1,this.storeUnits.forEach((function(n){n.territory===t.ownBase.territory&&n.base===t.ownBase.base&&n.amount>0&&e.push({key:n.unit,amount:n.amount})})),setTimeout((function(){n.showUnits=!0}),100),e},storeUnits:function(){return this.$store.state.game.user.units},defendersupply:function(){var t=0;return this.defenders.length>0&&this.defenders.forEach((function(e){t+=p["units"][e.key].supply*e.amount})),t},supply:function(){var t=0;return this.selectedUnits.forEach((function(e){t+=p["units"][e.key].supply*e.amount})),t},defensivePower:function(){var t=0,e=0;this.$store.state.game.user.units.forEach((function(e){t+=p["units"][e.unit].supply})),e=Math.round(100-m()(t/5).toFixed(0)/100);var n=this.$store.state.game.user.trainings.find((function(t){return"coordination"===t.key||"coordination"===t.training}));return n&&(e+=f()(n.lvl)/10),e>=100?100:e>=65?e:65},offensivePower:function(){var t=0,e=0;this.selectedUnits.forEach((function(e){t+=p["units"][e.key].supply*e.amount})),e=Math.round(100-m()(t/6).toFixed(0)/100);var n=this.$store.state.game.user.trainings.find((function(t){return"coordination"===t.key||"coordination"===t.training}));return n&&(e+=f()(n.lvl)/10),e>=100?100:e>=60?e:60},defenderOffensivePower:function(){var t=0,e=0;this.defenders.forEach((function(e){t+=p["units"][e.key].supply*e.amount})),e=Math.round(100-m()(t/6).toFixed(0)/100);var n=this.$store.state.game.user.trainings.find((function(t){return"coordination"===t.key||"coordination"===t.training}));return n&&(e+=f()(n.lvl)/10),e>=100?100:e>=65?e:65},cost:function(){var t={drugs:0,weapons:0,alcohol:0};return this.selectedUnits.forEach((function(e){t.drugs+=p["units"][e.key].drugs_cost*e.amount,t.weapons+=p["units"][e.key].weapons_cost*e.amount,t.alcohol+=p["units"][e.key].alcohols_cost*e.amount})),t},defendercost:function(){var t={drugs:0,weapons:0,alcohol:0};return this.defenders&&this.defenders.length>0&&this.defenders.forEach((function(e){t.drugs+=p["units"][e.key].drugs_cost*e.amount,t.weapons+=p["units"][e.key].weapons_cost*e.amount,t.alcohol+=p["units"][e.key].alcohols_cost*e.amount})),t},maxSupply:function(){var t=2e3*this.bunker.lvl;return t},tooMuchSupply:function(){return this.supply>this.maxSupply},bunker:function(){var t=this;return this.$store.state.game.user.buildings.find((function(e){return"bunker"===e.building&&e.base===t.$store.state.game.mainbase.base&&e.territory===t.$store.state.game.mainbase.territory}))||{lvl:0}}},methods:Object(l["a"])({},Object(v["b"])(["missions","init","get_bases","setBase"]),{loadDefenders:function(){var t=this;this.defenders=[];var e={base:this.ownBase.base,territory:this.ownBase.territory};b["a"].requestAsync("get_defenders",e).then((function(e){e&&e[0]&&e[0].json&&(t.defenders=JSON.parse(e[0].json).units),t.isLoading=!1}))},autoFill:function(){var t=this,e=[];this.ownUnits.forEach((function(t){"spy"!==t.key&&"occupation_troop"!==t.key&&"hobo"!==t.key&&e.push(t)})),e.forEach((function(n){if(!t.selectedUnits.find((function(t){return t.key===n.key}))&&t.supply<t.maxSupply/100*85){var s=Math.floor(t.maxSupply/e.length/p["units"][n.key].supply);s>n.amount&&(s=n.amount),t.selectedUnits.push({key:n.key,amount:s}),e.splice(0,1)}})),this.autoFill()},resetForm:function(){this.target=null,this.base=null,this.selectedUnits=[],this.message=null,this.target_type=null},chooseBase:function(t,e,n){this.target=t,this.base=e,this.farm_name="".concat(this.targetNickname," ").concat(n)},removeUnits:function(){this.selectedUnits=[]},handleSave:function(){var t=this;this.isLoading=!0;var e=this,n={};n={from_territory:Number(e.ownBase.territory),from_base:Number(e.ownBase.base),units:this.selectedUnits,type:"save-defense"},this.missions(n).then((function(){g.a.delay(3e3).then((function(){e.loadDefenders(),e.init(),t.isLoading=!1}))})).catch((function(e){console.error("Failed to start a fight=",e),t.isLoading=!1}))},handleRelease:function(){var t=this;this.isLoading=!0;var e=this,n={};n={from_territory:Number(e.ownBase.territory),from_base:Number(e.ownBase.base),type:"release-defense"},this.missions(n).then((function(){g.a.delay(3e3).then((function(){e.loadDefenders(),e.init(),t.isLoading=!1}))})).catch((function(e){console.error("Failed to start a fight=",e),t.isLoading=!1}))},validateForm:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.errorMessage=null,0===this.selectedUnits.length&&(this.errorMessage="Please select some units"),!this.errorMessage){t.next=4;break}return t.abrupt("return",!1);case 4:return t.abrupt("return",!this.errorMessage);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),addUnit:function(t){var e=f()(t.amount),n={},s=this.ownUnits.find((function(e){return e.key===t.key}));this.selectedUnits.forEach((function(t){n[t.key]=t.amount})),n[t.key]=n[t.key]?e+f()(n[t.key]):e,n[t.key]>s.amount&&(n[t.key]=f()(s.amount)),n[t.key]<0&&(n[t.key]=0),this.selectedUnits=u()(n).map((function(t){return{key:t,amount:n[t]}}))},serialize:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(t[n])));return e.join("&")},onEnd:function(){localStorage.setItem("fav_combi_def",a()(this.favoriteCombinations))},saveCombination:function(){var t=[];localStorage.getItem("fav_combi_def")&&(t=JSON.parse(localStorage.getItem("fav_combi_def")));var e=this.selectedUnits.map((function(t){return{key:t.key,amount:t.amount}})),n={};n.name=this.combination_name,n.set=e,t.push(n),this.favoriteCombinations=t,this.combination_name=null,localStorage.setItem("fav_combi_def",a()(t))},loadCombination:function(t){var e=this,n=[];t.forEach((function(t){e.ownUnits.find((function(e){return e.key===t.key}))&&t.amount<=e.ownUnits.find((function(e){return e.key===t.key})).amount?n.push(t):(e.ownUnits.find((function(e){return e.key===t.key}))&&(t.amount=e.ownUnits.find((function(e){return e.key===t.key})).amount),n.push(t))})),this.selectedUnits=n},deleteCombination:function(t){var e=[];localStorage.getItem("fav_combi_def")&&(e=JSON.parse(localStorage.getItem("fav_combi_def")));for(var n=0;n<e.length;n+=1)e[n].name===t&&(e.splice(n,1),n-=1);localStorage.setItem("fav_combi_def",a()(e)),this.favoriteCombinations=e}})},U=w,C=(n("ee19"),n("2877")),S=Object(C["a"])(U,s,i,!1,null,"25afc6eb",null);e["default"]=S.exports},ee19:function(t,e,n){"use strict";var s=n("09ee"),i=n.n(s);i.a}}]);
//# sourceMappingURL=unitsbunker.3618d372.js.map