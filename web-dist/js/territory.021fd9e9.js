(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["territory"],{"36bd":function(e,t,i){"use strict";var n=i("4bf8"),a=i("77f1"),r=i("9def");e.exports=function(e){var t=n(this),i=r(t.length),s=arguments.length,o=a(s>1?arguments[1]:void 0,i),l=s>2?arguments[2]:void 0,c=void 0===l?i:a(l,i);while(c>o)t[o++]=e;return t}},"6c7b":function(e,t,i){var n=i("5ca1");n(n.P,"Array",{fill:i("36bd")}),i("9c6c")("fill")},"7b7c":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("ActionsTabs"),i("div",{staticClass:"card mb-0",staticStyle:{"margin-top":"-15px"}},[i("div",{staticClass:"content"},[i("div",{staticClass:"tabs tabs-box"},[i("div",{staticClass:"tab-controls rounded-s border-highlight"},[i("UiButton",{staticClass:" gradient-highlight",on:{click:function(t){e.decreaseLocation()}}},[i("i",{staticClass:"fad fa-arrow-left color-black"})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.currentLocation,expression:"currentLocation"}],staticClass:"input color-highlight w-100",attrs:{type:"number",placeholder:"25"},domProps:{value:e.currentLocation},on:{change:function(t){e.updateLocation(e.currentLocation)},input:function(t){t.target.composing||(e.currentLocation=t.target.value)}}}),i("UiButton",{staticClass:"gradient-highlight",on:{click:function(t){e.increaseLocation()}}},[i("i",{staticClass:"fad fa-arrow-right color-black"})])],1)]),i("div",{staticClass:"d-flex"})])]),e.location>5e3||e.location<1?i("div",[i("div",{staticClass:"card card-style shadow-card shadow-card-l",staticStyle:{"min-height":"150px"},style:"background-image:url(/img/tasks/42.jpg"},[e._m(0),i("div",{staticClass:"card-overlay bg-gradient-fade opacity-80"})])]):i("div",{staticClass:"territorybg",staticStyle:{height:"100vw",width:"100vw"},attrs:{id:"territorybg"}},[i("div",{staticClass:"title",style:e.selectedTile?"display: block;":"display:none",attrs:{id:"title"}},[i("h5",[e._v("BASE "+e._s(e.selectedTile))]),i("div",{staticClass:"mt-0"},[e.currentNickname?i("div",[e._v(" Under the control of : "),i("h5",[e._v(e._s(e.currentNickname))])]):i("span",[e._v("Nobody lives here ")]),e.currentGang&&null!==e.currentGang.role&&e.currentGang.ticker?i("div",[e._v("\n          "+e._s(e.currentGang.role)+" of "+e._s(e.currentGang.name)+" ["+e._s(e.currentGang.ticker)+"]\n        ")]):e._e()]),e.selectedTile&&e.nickname?i("div",[i("div",{staticClass:"mt-0"},[e._v("HQ LEVEL : "+e._s(e.currentHq))])]):e._e(),i("div",{staticClass:"map-title text-left",attrs:{id:"visit"}},[e.selectedTile&&e.currentNickname&&e.currentNickname!=e.nickname?i("router-link",{attrs:{to:"/actions?type=attack&target="+e.location+"&base="+e.selectedTile}},[i("UiButton",{staticClass:"btn bg-red-light border-red-dark"},[e._v("ATTACK")])],1):e._e(),e.main?e._e():i("UiButton",{staticClass:"btn gradient-highlight text-black",on:{click:function(t){e.handleSubmit()}}},[e._v("\n          CHOOSE AS MAIN BASE\n        ")])],1)]),e._m(1)])],1)},a=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"card-bottom pb-3 px-3"},[i("h3",{staticClass:"color-white"},[e._v("Out of City")]),i("p",{staticClass:"color-white opacity-70 mb-0 mt-n1"},[e._v("This location is not available yet.")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("table",{staticStyle:{position:"relative"},attrs:{id:"table"}},[i("div",{staticClass:"overlay"}),i("canvas",{staticStyle:{cursor:"pointer",height:"100vw",width:"100vw"},attrs:{id:"canvas"}})])}],r=i("768b"),s=(i("96cf"),i("3b8d")),o=(i("6c7b"),i("7f7f"),i("ac6a"),i("c5f6"),i("cebc")),l=(i("7514"),i("451e")),c=i("2f62"),u=i("f684"),g=i.n(u),d={data:function(){return{isMain:null,isLoading:!1,selectedTile:null,selected:null,customName:null,currentNickname:null,currentGang:null,currentHq:null,job:null,nickname:this.$store.state.game.user.user.nickname,bases:[],currentLocation:null,dragging:!1,iso:!1,x:"no",y:"no",maprng:null,canvasWidth:500}},watch:{location:function(e){e&&(console.log(e),this.updateLocation())}},computed:{main:function(){if(this.base)return this.$store.state.game.user.buildings.find((function(e){return 1===e.main}))||null},location:function(){return this.$route.query.location||null},base:function(){return this.$store.state.game.mainbase},ownOccupationTroop:function(){return this.$store.state.game.user.units.find((function(e){return"occupation_troop"===e.unit}))?this.$store.state.game.user.units.find((function(e){return"occupation_troop"===e.unit})).amount||{amount:0}:0}},methods:Object(o["a"])({increaseLocation:function(){this.$router.push({path:"/map/territory?location=".concat(Number(this.location)+1)})},decreaseLocation:function(){this.$router.push({path:"/map/territory?location=".concat(Number(this.location)-1)})},start:function(){var e=this,t=document.getElementById("territorybg"),i=document.getElementById("canvas"),n=i.getContext("2d"),a=[],r=0,s=0;function o(){var e=i.getContext("2d");e.clearRect(0,0,r,s)}function l(e,t,i,n,a,r,s,o,l,c,u,g,d){this.id=a,this.nickname=r||null,this.level=s||null,this.gang=c||null,this.job=u||null,this.custom_name=o||null,this.main=l||null,this.x=e,this.y=t,this.width=50,this.height=50,this.workWidth={start:e,end:e+i},this.workHeight={start:t,end:t+n},this.fillColor=g,this.strokeStyle="red"}r=t.offsetWidth,s=t.offsetWidth,i.width=r,i.height=s,e.canvasWidth=r;var c=document.getElementById("title");function u(e,t){var i,n=t.getBoundingClientRect(),r=e.clientX-n.left,s=e.clientY-n.top+window.scrollY;return a.forEach((function(e){r>e.workWidth.start&&r<e.workWidth.end&&s>e.workHeight.start&&s<e.workHeight.end&&(i={id:e.id,nickname:e.nickname,hq:e.level,custom_name:e.custom_name,main:e.main,gang:e.gang,job:e.job})})),i}function g(t,n){a=[];var r=t*n,s=i.width/t,o=i.height/n;console.log(s,o);for(var c={x:0,y:0},u=function(t){var n="",r="",u="",g="",d="",h={},m="";e.bases.forEach((function(i){i.base!==t||void 0==i.job||i.nickname?i.base===t&&i.nickname===e.nickname?(n="green",r=i.nickname,h={role:i.role,gang:i.name,ticker:i.ticker},u=i.lvl,g=i.custom,d=i.main):i.base===t&&i.nickname!==e.nickname&&(n="red",r=i.nickname,h={role:i.role,gang:i.name,ticker:i.ticker},u=i.lvl,g=i.custom,d=i.main):(n="rgba(255, 206, 84, 0.5)",r=i.nickname,u=i.lvl,g=i.custom,d=i.main,m=i.job)}));var f=new l(c.x,c.y,s,o,t,r,u,g,d,h,m,n);a.push(f),c.x+=s,c.x>=i.width&&(c.x=0,c.y+=o)},g=1;g<r+1;g++)u(g)}i.onclick=function(t){event=t,console.log(t);var n=u(event,i);null!=e.selectedTile&&e.nickname===e.currentNickname?(a[e.selectedTile-1].fillColor="green",o()):null!=e.selectedTile&&e.currentNickname&&e.nickname!==e.currentNickname?(a[e.selectedTile-1].fillColor="red",o()):null!=e.selectedTile&&!e.currentNickname&&e.job?a[e.selectedTile-1].fillColor="#f6bb428f":null!=e.selectedTile&&(a[e.selectedTile-1].fillColor=null),e.selectedTile=n.id,e.currentNickname=n.nickname,e.currentHq=n.hq,e.customName=n.custom_name,e.isMain=n.main,e.currentGang=n.gang,e.job=n.job,n.job&&!n.nickname?a[n.id-1].fillColor="#ffc508":n.nickname===e.nickname?a[n.id-1].fillColor="green":n.nickname!==e.nickname?a[n.id-1].fillColor="#ffc508":a[n.id-1].fillColor="gray",a[n.id]&&!n.job?(c.style.display="block",0===a[n.id].x?(c.style.top="".concat(a[n.id].y+4,"px"),c.style.left="initial",c.style.right="".concat(48,"px")):a[n.id].x>i.width/2||a[n.id].x>i.width?(c.style.top="".concat(a[n.id].y+54,"px"),c.style.left="initial",c.style.right="".concat(i.width-a[n.id].x+48,"px")):(c.style.top="".concat(a[n.id].y+54,"px"),c.style.right="initial",c.style.left="".concat(a[n.id].x,"px"))):n.job&&(c.style.display="none"),B()};var d=new Image,h=new Image,m=new Image,f=new Image,p=new Image,b=new Image,v=new Image,w=new Image,y=new Image,k=new Image,x=new Image,C=new Image,I=new Image,_=new Image,L=new Image,T=new Image,S=new Image,j=new Image,M=new Image,N=new Image;function B(){var t=new Image;t.src="/img/mapbg.png",t.onload=function(){n.imageSmoothingEnabled=!0,n.drawImage(t,0,0,canvas.width,canvas.height),n.restore(),a.forEach((function(t){t.fillColor?t.level>99?n.drawImage(N,t.x,t.y,t.width,t.height):t.level>79?n.drawImage(M,t.x,t.y,t.width,t.height):t.level>59?n.drawImage(j,t.x,t.y,t.width,t.height):t.level>49?n.drawImage(S,t.x,t.y,t.width,t.height):t.level>39?n.drawImage(T,t.x,t.y,t.width,t.height):t.level>29?n.drawImage(L,t.x,t.y,t.width,t.height):t.level>19?n.drawImage(_,t.x,t.y,t.width,t.height):t.level>9?n.drawImage(I,t.x,t.y,t.width,t.height):t.level>0?n.drawImage(C,t.x,t.y,t.width,t.height):n.drawImage(d,72*e.maprng[t.id].x,72*e.maprng[t.id].y,72,72,t.x,t.y,r/10,r/10):n.drawImage(d,72*e.maprng[t.id].x,72*e.maprng[t.id].y,72,72,t.x,t.y,r/10,r/10),e.canvasWidth<500?(n.beginPath(),t.fillColor?(n.strokeStyle=t.fillColor,n.fillStyle="rgba(5, 0, 0, 0.0)"):(n.fillStyle="rgba(5, 0, 0, 0.0)",n.strokeStyle="rgba(5, 0, 0, 0.0)"),"green"===t.fillColor?n.drawImage(k,t.x,t.y,t.width-8,t.height):"red"===t.fillColor?(n.strokeStyle="red",n.drawImage(x,t.x-2,t.y-2,t.width+4,t.height+4)):n.roundRect(t.x+6,t.y+6,t.width-20,t.height-20,[5,5]),n.lineWidth=3,n.stroke(),n.fill(),n.textAlign="center",n.font="10px Arial",n.fillStyle="#fff",n.strokeStyle="black",n.strokeText(t.id,t.x+20,t.y+25),n.fillText(t.id,t.x+20,t.y+25,t.width)):(n.beginPath(),t.fillColor?(n.strokeStyle=t.fillColor,n.fillStyle="rgba(5, 0, 0, 0.0)"):(n.fillStyle="rgba(5, 0, 0, 0.0)",n.strokeStyle="rgba(5, 0, 0, 0.0)"),"green"===t.fillColor?n.drawImage(k,t.x,t.y,t.width,t.height):"red"===t.fillColor?(n.strokeStyle="red",n.drawImage(x,t.x-2,t.y-2,t.width+4,t.height+4)):n.roundRect(t.x+8,t.y+8,t.width-16,t.height-15,[5,5]),n.lineWidth=3,n.stroke(),n.fill(),n.textAlign="center",n.font="10px Arial",n.fillStyle="#fff",n.strokeStyle="black",n.strokeText(t.id,t.x+25,t.y+38),n.fillText(t.id,t.x+25,t.y+38,t.width))}))}}k.src="/img/map/select.png",x.src="/img/map/enemy.png",C.src="/img/map/levels/1.png",I.src="/img/map/levels/2.png",_.src="/img/map/levels/3.png",L.src="/img/map/levels/4.png",T.src="/img/map/levels/5.png",S.src="/img/map/levels/6.png",j.src="/img/map/levels/7.png",M.src="/img/map/levels/8.png",N.src="/img/map/levels/9.png",d.src="/img/map/buldingtiles.png",h.src="//img.drugwars.io/map/first.png",f.src="//img.drugwars.io/map/first.png",v.src="//img.drugwars.io/map/first.png",w.src="//img.drugwars.io/map/first.png",h.src="//img.drugwars.io/map/home.png",m.src="//img.drugwars.io/map/tree.png",f.src="//img.drugwars.io/map/buildingtop.png",p.src="//img.drugwars.io/map/buildingbottom.png",b.src="//img.drugwars.io/map/fountain.png",v.src="//img.drugwars.io/map/pool.png",w.src="//img.drugwars.io/map/heliport.png",y.src="//img.drugwars.io/map/home.png",g(10,10),B()}},Object(c["b"])(["send","notify","setMainBase"]),{handleSubmit:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,n,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this,e.next=3,this.validateFormFree();case 3:i=e.sent,this.isLoading=!0,i&&this.location&&this.selectedTile?(n={type:"dw-firstloc",territory:Number(this.location),base:Number(this.selectedTile)},this.send(n).then((function(){g.a.delay(2e3).then((function(){l["a"].requestAsync("get_bases",a.location).then((function(e){var i=Object(r["a"])(e,1);t.bases=i[0],a.setMainBase({territory:e[0][0].territory,base:e[0][0].base,custom:e[0][0].custom,main:e[0][0].main}),t.$router.push("/buildings"),t.isLoading=!1}))}))})).catch((function(e){a.notify({type:"error",message:"Failed to take base"}),console.error("Failed to take base",e),a.isLoading=!1}))):this.isLoading=!1;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),validateFormFree:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,n,a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.errorMessage=null,t=this.selectedTile,i=this.location,n={base:t,territory:i},this.$store.state.game.user.buildings.find((function(e){return 1===e.main&&0!==e.territory}))&&(this.errorMessage="You already have a main base!"),t&&i||(this.errorMessage="Please choose a location and a base"),a=new Date,r=new Date(Date.parse(this.$store.state.game.user.user.punished)),r>a&&(this.errorMessage="Hmm Bad talks are not appropriated in GoldWars, try again after ".concat(r.toLocaleString())),this.errorMessage){e.next=23;break}return e.prev=10,e.next=13,l["a"].requestAsync("check_base",n);case 13:return s=e.sent,s&&(this.errorMessage="Base number '".concat(s,"' is already taken")),e.abrupt("return",!this.errorMessage);case 18:return e.prev=18,e.t0=e["catch"](10),this.errorMessage="Base number '".concat(t,"' doesn't exist"),console.error("Base number '".concat(t,"' doesn't exist"),e.t0),e.abrupt("return",!1);case 23:if(!this.errorMessage){e.next=25;break}return e.abrupt("return",!1);case 25:return e.abrupt("return",!this.errorMessage);case 26:case"end":return e.stop()}}),e,this,[[10,18]])})));function t(){return e.apply(this,arguments)}return t}(),selectBase:function(){var e=this.location,t=this.selectedTile,i=this.customName,n=this.isMain;this.setMainBase({territory:e,base:t,custom:i,main:n})},updateLocation:function(e){var t=this;if(t.bases=null,t.selectedTile=null,t.currentLocation!==t.location){var i=function(e){return function(){return e=(n*e+a)%s,e/s}};t.currentLocation=e||t.location;for(var n=1664525,a=1013904223,s=4294967296,o=i(t.currentLocation),c=[],u=0;u<103;u++)c.push({x:Math.floor(10*o()),y:Math.floor(10*o())});t.maprng=c,this.$router.push({path:"/map/territory?location=".concat(Number(t.currentLocation))}),l["a"].requestAsync("get_bases",t.currentLocation).then((function(e){var i=Object(r["a"])(e,1);t.bases=i[0],e[1].forEach((function(e){t.bases.push(e)})),t.start(),t.isLoading=!1}))}}}),mounted:function(){var e=this;e.bases=null,e.currentLocation=e.location,l["a"].requestAsync("get_bases",this.location).then((function(t){var i=Object(r["a"])(t,1);e.bases=i[0],t[1].forEach((function(t){e.bases.push(t)}));var n=1664525,a=1013904223,s=4294967296;function o(e){return function(){return e=(n*e+a)%s,e/s}}for(var l=o(e.currentLocation),c=[],u=0;u<103;u++)c.push({x:Math.floor(10*l()),y:Math.floor(10*l())});e.maprng=c,e.start(),e.isLoading=!1}))}},h=d,m=(i("8fdc"),i("2877")),f=Object(m["a"])(h,n,a,!1,null,"eddc2c26",null);t["default"]=f.exports},"8fdc":function(e,t,i){"use strict";var n=i("f38a"),a=i.n(n);a.a},f38a:function(e,t,i){}}]);
//# sourceMappingURL=territory.021fd9e9.js.map