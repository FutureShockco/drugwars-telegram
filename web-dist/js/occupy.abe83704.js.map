{"version":3,"sources":["webpack:///./src/views/Actions/Occup.vue?aa94","webpack:///src/views/Actions/Occup.vue","webpack:///./src/views/Actions/Occup.vue?a666","webpack:///./src/views/Actions/Occup.vue","webpack:///./src/views/Actions/Occup.vue?daa3"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","ownUnits","length","_v","_l","ownUnit","key","amount","attrs","on","addUnit","_e","selectedUnits","directives","name","rawName","value","expression","domProps","$event","target","composing","territory","base","hasNotEnough","isLoading","selectedTotal","carry","handleSubmit","_s","errorMessage","staticRenderFns","data","$route","query","message","username","$store","state","auth","created","computed","user","game","sent_fights","nickname","ownBase","mainbase","units","map","methods","resetForm","progressPercent","total","cost","up","progress","removeUnits","forEach","selectedUnitsObj","unit","payload","component"],"mappings":"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","file":"js/occupy.abe83704.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('ActionsTabs'),_c('div',{staticClass:\"p-4 mt-2 columns\"},[(_vm.ownUnits.length > 0)?_c('div',{staticClass:\"column b col-6 text-center\"},[_c('h3',[_vm._v(\"Select your army composition\")]),_c('div',_vm._l((_vm.ownUnits),function(ownUnit){return _c('div',{key:ownUnit.key},[(ownUnit.amount > 0)?_c('UnitSelect',{key:ownUnit.key,attrs:{\"item\":ownUnit},on:{\"click\":_vm.addUnit}}):_vm._e()],1)}))]):_vm._e(),(_vm.ownUnits.length > 0)?_c('div',{staticClass:\"column b col-6 text-center\"},[_c('div',[_c('div',{staticClass:\"mb-2\"},[_c('h3',{staticClass:\"mb-2\"},[_vm._v(\"Your selected army\")]),_c('ArmyToSend',{attrs:{\"units\":_vm.selectedUnits}})],1)]),_c('div',{staticClass:\"mb-0 form width-full\"},[(_vm.selectedUnits.length === 0)?_c('div',[_c('p',[_vm._v(\"You need to select at least 1 occupation troop.\")])]):_vm._e()]),_c('h3',[_vm._v(\"Select your target user\")]),_c('div',[_vm._v(\"\\n                Territory :\\n                \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.territory),expression:\"territory\"}],staticClass:\"input form-control mb-4\",attrs:{\"type\":\"number\",\"placeholder\":\"Territory\"},domProps:{\"value\":(_vm.territory)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.territory=$event.target.value}}})]),_c('div',[_vm._v(\"\\n                Base :\\n                \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.base),expression:\"base\"}],staticClass:\"input form-control mb-4\",attrs:{\"type\":\"number\",\"placeholder\":\"Base\"},domProps:{\"value\":(_vm.base)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.base=$event.target.value}}})]),_c('div',[_vm._v(\"\\n                Name :\\n                \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.name),expression:\"name\"}],staticClass:\"input form-control mb-4\",attrs:{\"placeholder\":\"Base name\"},domProps:{\"value\":(_vm.name)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.name=$event.target.value}}})]),_c('UiButton',{staticClass:\"button button-large button-blue mb-4\",attrs:{\"disabled\":_vm.selectedUnits.length === 0 || !_vm.territory || _vm.hasNotEnough || _vm.isLoading || _vm.selectedTotal > _vm.carry},on:{\"click\":_vm.handleSubmit}},[(_vm.isLoading)?_c('SmallLoading'):_c('span',[_vm._v(\"Take base\")])],1),(_vm.errorMessage)?_c('p',{staticClass:\"text-red text-left\"},[_vm._v(\"\\n                \"+_vm._s(_vm.errorMessage)+\"\\n            \")]):_vm._e()],1):_c('div',[_c('p',[_vm._v(\"You don't have any unit.\")])])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div>\n        <ActionsTabs/>\n        <div class=\"p-4 mt-2 columns\">\n            <div v-if=\"ownUnits.length > 0\" class=\"column b col-6 text-center\">\n                <h3>Select your army composition</h3>\n                <div>\n                    <div v-for=\"ownUnit in ownUnits\" :key=\"ownUnit.key\">\n                        <UnitSelect :item=\"ownUnit\" :key=\"ownUnit.key\" @click=\"addUnit\" v-if=\"ownUnit.amount > 0\" />\n                    </div>\n                </div>\n            </div>\n            <div v-if=\"ownUnits.length > 0\" class=\"column b col-6 text-center\">\n                <div>\n                    <div class=\"mb-2\">\n                        <h3 class=\"mb-2\">Your selected army</h3>\n                        <ArmyToSend :units=\"selectedUnits\" />\n                    </div>\n    \n                </div>\n                <div class=\"mb-0 form width-full\">\n                    <div v-if=\"selectedUnits.length === 0\">\n                        <p>You need to select at least 1 occupation troop.</p>\n                    </div>\n                </div>\n                <h3>Select your target user</h3>\n                <div>\n                    Territory :\n                    <input class=\"input form-control mb-4\" type=\"number\" placeholder=\"Territory\" v-model=\"territory\">\n                </div>\n                <div>\n                    Base :\n                    <input class=\"input form-control mb-4\" type=\"number\" placeholder=\"Base\" v-model=\"base\">\n                </div>\n                <div>\n                    Name :\n                    <input class=\"input form-control mb-4\" placeholder=\"Base name\" v-model=\"name\">\n                </div>\n                <UiButton :disabled=\"selectedUnits.length === 0 || !territory || hasNotEnough || isLoading || selectedTotal > carry\" class=\"button button-large button-blue mb-4\" @click=\"handleSubmit\">\n                          <SmallLoading v-if=\"isLoading\"/>\n                        <span v-else>Take base</span>\n                      </UiButton>\n                <p class=\"text-red text-left\" v-if=\"errorMessage\">\n                    {{ errorMessage }}\n                </p>\n            </div>\n            <div v-else>\n                <p>You don't have any unit.</p>\n            </div>\n    \n        </div>\n    </div>\n</template>\n\n<script>\n/* eslint-disable */\n\nimport { mapActions } from 'vuex';\nimport client from '@/helpers/client';\nimport { units } from 'drugwars';\nexport default {\n  data() {\n    return {\n      isLoading: false,\n      territory: this.$route.query.target || null,\n      base: this.$route.query.base || null,\n      selectedUnits: [],\n      message: null,\n      name: null,\n      username: this.$store.state.auth.username,\n      errorMessage: null,\n    };\n  },\n  created() {},\n  computed: {\n    user() {\n      return this.$store.state.game.user.user;\n    },\n    sent_fights() {\n      return this.$store.state.game.sent_fights;\n    },\n    nickname() {\n      return this.$store.state.game.user.user.nickname;\n    },\n    ownBase() {\n      return this.$store.state.game.mainbase;\n    },\n    ownUnits() {\n      return this.$store.state.game.user.units.map(unit => ({\n        key: unit.unit,\n        amount: unit.amount,\n      }));\n    },\n    hasNotEnough() {\n      return (\n        parseInt(this.drugs_amount) > this.user.drugs_balance ||\n        parseInt(this.weapons_amount) > this.user.weapons_balance ||\n        parseInt(this.alcohol_amount) > this.user.alcohols_balance ||\n        parseInt(this.dwd_amount) > this.user.dwd\n      );\n    },\n  },\n  methods: {\n    ...mapActions(['send', 'init', 'get_bases', 'setBase']),\n    resetForm() {\n      this.territory = null;\n      this.selectedUnits = [];\n      this.base = null;\n      this.name = null;\n    },\n    progressPercent(total, cost) {\n      let progress;\n      if (total && cost) {\n        this.up = false;\n        progress = parseFloat((total * 100) / cost).toFixed(2);\n        return progress;\n      }\n      this.up = false;\n      return 0;\n    },\n    removeUnits() {\n      this.selectedUnits = [];\n    },\n    async handleSubmit() {\n      const self = this;\n      const isValid = await this.validateForm();\n      if (isValid) {\n        this.isLoading = true;\n        if (this.territory > 0 && this.base > 0) {\n          const payload = {\n            territory: Number(this.territory),\n            base: Number(this.base),\n            name: this.name,\n            type: 'dw-base',\n          };\n          this.send(payload)\n            .then(() => {\n              self.resetForm();\n              client.requestAsync('get_bases', this.location).then(result => {\n                self.init();\n                self.isLoading = false;\n              });\n              self.isLoading = false;\n            })\n            .catch(e => {\n              console.error('Failed to start a fight=', e);\n              this.isLoading = false;\n            });\n        } else {\n          this.isLoading = false;\n          this.errorMessage = 'Not enough resources?';\n        }\n      } else {\n        this.isLoading = false;\n      }\n    },\n    async validateForm() {\n      this.errorMessage = null;\n      const base = this.base;\n      const territory = this.territory;\n      const params = { base, territory };\n      const now = new Date();\n      if (!this.name) {\n        this.errorMessage = `Please choose a name for your base`;\n      }\n      if (this.name.length > 25) {\n        this.errorMessage = `Please choose a shorter name for your base`;\n      }\n      const isPunished = new Date(Date.parse(this.$store.state.game.user.user.punished));\n      if (isPunished > now) {\n        this.errorMessage = `Hmm Bad talks are not appropriated in DrugWars, try again after ${isPunished.toLocaleString()}`;\n      }\n\n      if (!this.errorMessage)\n        try {\n          const baseIsValid = await client.requestAsync('check_base', params);\n          if (baseIsValid) {\n            this.errorMessage = `Base number '${base}' is already taken`;\n          }\n          return !this.errorMessage;\n        } catch (e) {\n          this.errorMessage = `Base number '${base}' doesn't exist`;\n          console.error(`Base number '${base}' doesn't exist`, e);\n          return false;\n        }\n      if (this.errorMessage) {\n        return false;\n      }\n      return !this.errorMessage;\n    },\n    addUnit(payload) {\n      const amount = parseInt(payload.amount);\n      const selectedUnitsObj = {};\n      const ownUnit = this.ownUnits.find(unit => unit.key === payload.key);\n\n      this.selectedUnits.forEach(unit => {\n        selectedUnitsObj[unit.key] = unit.amount;\n      });\n      selectedUnitsObj[payload.key] = !selectedUnitsObj[payload.key]\n        ? amount\n        : amount + parseInt(selectedUnitsObj[payload.key]);\n      if (selectedUnitsObj[payload.key] > ownUnit.amount) {\n        selectedUnitsObj[payload.key] = parseInt(ownUnit.amount);\n      }\n      if (selectedUnitsObj[payload.key] < 0) {\n        selectedUnitsObj[payload.key] = 0;\n      }\n\n      this.selectedUnits = Object.keys(selectedUnitsObj).map(key => ({\n        key,\n        amount: selectedUnitsObj[key],\n      }));\n    },\n  },\n};\n</script>\n\n\n<style scoped lang=\"less\">\n.width-full {\n  max-width: 100%;\n}\n\n@media screen and (min-width: 399px) and (max-width: 1119px) {\n  .column.b {\n    width: 100% !important;\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Occup.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Occup.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Occup.vue?vue&type=template&id=63eb1571&scoped=true&\"\nimport script from \"./Occup.vue?vue&type=script&lang=js&\"\nexport * from \"./Occup.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Occup.vue?vue&type=style&index=0&id=63eb1571&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"63eb1571\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Occup.vue?vue&type=style&index=0&id=63eb1571&scoped=true&lang=less&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Occup.vue?vue&type=style&index=0&id=63eb1571&scoped=true&lang=less&\""],"sourceRoot":""}